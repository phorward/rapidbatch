<html>
	<head>
		<title>RapidBATCH Befehlsreferenz :: EXT</title>
		<link rel="stylesheet" href="jmksf.css" type="text/css" />
	</head>
	<body>
		<div id="top">
			<img src="rb5.png" alt="RapidBATCH Logo" />
			EXT
		</div>
	
		<div class="line">&nbsp;</div>
	
		<table cellspacing="10" width="100%">
			<tr>
				<td class="ref_label">Syntax:</td>
				<td class="ref_syntax">EXT R&uuml;ckgabewert = DLL-Datei, Funktionsname [, Parameter<sup>1</sup> [ ..., Parameter<sup>n</sup>] ]</td>
			</tr>
			<tr>
				<td class="ref_label">Beschreibung:</td>
				<td>Ruft eine externe Funktion aus einer DLL-Bibliotheksdatei auf.<br /><br />Mit EXT k&ouml;nnen daher selbst-entwickelte und spezielle Funktionalit&auml;ten in RapidBATCH verwendet und genutzt werden. Diese Funktionen werden in Programmiersprachen wie C, C++, Pascal oder Delphi realisiert.<br /><br />&Uuml;ber EXT aufgerufene Funktionen m&uuml;ssen dem EXT-Schnittstellenformat entsprechen, ansonsten sind sie nicht korrekt aufrufbar. Das Format f&uuml;r eine Funktion (hier in der Programmiersprache C realisiert) ist wie Folgt definiert:<pre>int __declspec( dllexport ) _cdecl<br />	Funktionsname( char** output, char** input, int input_count )<br />{<br />	/*<br />	Hier folgt der ausf&uuml;hrbare Code ...<br />	*/<br /><br />	return 0;<br />}</pre>Die Parameter, die einer externen Funktion &uuml;bergeben werden, werden wiefolgt gehandhabt:<ul><li><b>char** output</b><br />Hierbei handelt es sich um einen Pointer, der entsprechend mit Speicher allokiert werden muﬂ, wenn die Funktion einen Wert an die beim Aufruf von EXT &uuml;bergebene R&uuml;ckagbevariable zur&uuml;ckgeben soll. Dieser Speicher sollte mit der Windows API Funktion LocalAlloc() und dem Parameter LPTR allokiert werden. Wird *output auf (char*)NULL gesetzt bzw. belassen, gibt EXT einen Leerstring zur&uuml;ck. Die Schnittstelle gibt den mit LocalAlloc() allokierten Wert automatisch wieder frei.</li><li><b>char** input</b><br />Bei diesem Pointer handelt es sich um ein Array von Char-Pointern, in der jeder Eintrag einem Parameterwert entspricht, der beim Aufruf von EXT im RapidBATCH-Script &uuml;bergeben wurde.</li><li><b>int input_count</b><br />Enth&auml;lt die Anzahl der Eintr&auml;ge im Array input[].</li></ul></td>
			</tr>
			<tr>
				<td class="ref_label">Beispiele:</td>
				<td class="ref_code"><br /><font color="#808080">rem Funktionen der DLL-Biblothek (C-Code)</font><br /><font color="#808080">rem</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;#define BUFFSIZE 10000</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;#define TEXTSIZE   100</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;#define ERROR_BAD_INPUT 11</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;&nbsp;&nbsp;&nbsp;gsSeparator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= (char*)NULL;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;&nbsp;&nbsp;&nbsp;gsBuffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= (char*)NULL;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;BOOL CALLBACK EnumWindowsProc( HWND hwnd, LPARAM lParam )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;{</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;&nbsp;&nbsp;&nbsp;Title[TEXTSIZE];</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset( Title, '\0', TEXTSIZE );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText( hwnd, Title, TEXTSIZE-1 );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( *Title != '\0' )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( IsWindowVisible( hwnd ) )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( *gsBuffer != '\0' )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcat( gsBuffer, gsSeparator );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcat( gsBuffer, Title );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( strlen( gsBuffer ) + strlen( gsSeparator ) + TEXTSIZE < BUFFSIZE )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( TRUE );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( FALSE );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( TRUE );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;}</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;int __declspec(dllexport ) _cdecl rbxCreateWindowList( char** Output, char** Input, int InputCount )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;{</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( Output == NULL )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( -1 );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*Output = LocalAlloc( LPTR, BUFFSIZE );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( *Output == NULL )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( -1 );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( InputCount != 1 || Input == NULL || *Input == NULL || **Input == 0 || strlen( *Input ) > TEXTSIZE )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( -2 );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gsBuffer = *Output;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gsSeparator = *Input;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnumWindows( EnumWindowsProc,( LPARAM )NULL );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( 0 );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;}</font><br /><font color="#808080">rem</font><br /><font color="#808080">rem Aufruf der Funktion:</font><br /><br /><b>ext</b> <font color="#000080">[fensterliste]</font> = <font color="#0000ff">'Test.dll'</font>, <font color="#0000ff">'rbxCreateWindowList'</font>, <font color="#000080">[new_line]</font><br />echo <font color="#0000ff">'Offene Fenster: '</font> # <font color="#000080">[new_line]</font> # <font color="#000080">[new_line]</font> # <font color="#000080">[fensterliste]</font><br /><b>end</b></td>
			</tr>
			<tr>
				<td class="ref_label">Bemerkungen:</td>
				<td>Beim ersten Aufruf einer Funktion aus einer DLL wird die DLL in den Speicher geladen und initialisiert. Die DLL bleibt dann bis zum Programmende im Speicher und wird dann zusammen mit der Anwendung automatisch entladen.<br /><br />Jede DLL muss eine Funktion LibMain() enthalten. Diese Funktion wird automatisch beim Laden und Entladen der DLL aufgerufen. Die DLL kann in dieser Routine z.B. bei Laden Variablen initialisieren oder beim Beenden benutzte Objekte wieder freigeben oder tempor&auml;re Dateien l&ouml;schen. Die Funktion LibMain() muss beim Laden der DLL den Wert TRUE zur&uuml;ckgeben, sonst wird der Ladevorgang abgebrochen und die DLL wird sofort wieder entladen. RapidBATCH w&uuml;rde dann [errorcode] = '-1' liefern - so als wenn die DLL nicht gefunden wurde. Beim Entladen wird der R&uuml;ckgabewert der Funktion LibMain ignoriert.<br /><br />Beim ersten Aufruf eines EXT-Befehls wird zuerst die DLL geladen (und damit LibMain() ausgef&uuml;hrt), dann wird die Funktion gesucht und aufgerufen. Bei weiteren EXT-Befehlen, die dieselbe DLL benutzen, wird direkt die angegebene Funktion gesucht und aufgerufen.</td>
			</tr>
		</table>
	
		<div class="line">&nbsp;</div>
	
		<div id="copyright">
			Copyright &copy; 2000-2006 by J.M.K S.F. Software Technologies, Jan Max Meyer<br />
			All rights reserved.
		</div>
	</body>
</html>
