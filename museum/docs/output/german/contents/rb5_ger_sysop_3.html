<html>
	<head>
		<title>Dateioperationen im Filesystem</title>
		<link rel="stylesheet" href="jmksf.css" type="text/css"></link>
	</head>

	<body>
		<div id="top">
			<img src="rb5.png" alt="RapidBATCH Logo" />
			Dateioperationen im Filesystem
		</div>
		
		<div class="line">&nbsp;</div>
		
		Um Dateien zu verwalten, bietet Ihnen RapidBATCH die Anweisungen und Funktionen NEWFILE, DELFILE, COPYFILE, RENAMEFILE, FILEEXISTS und FINDFILES.<br /><br />Die Anweisung NEWFILE erzeugt eine leere Datei, DELFILE l&ouml;scht eine existierende Datei. Die Syntax ist bei beiden Anweisungen &auml;quivalent:<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem Datei erzeugen</font><br />newfile <font color="#0000ff">'leer.txt'</font><br /><b>if</b> <font color="#000080">[errorcode]</font> = <font color="#0000ff">'0'</font> echo <font color="#0000ff">'Datei leer.txt wurde erzeugt!'</font><br /><br /><font color="#808080">rem Datei l&ouml;schen</font><br />delfile <font color="#0000ff">'leer.txt'</font><br /><b>if</b> <font color="#000080">[errorcode]</font> = <font color="#0000ff">'0'</font> echo <font color="#0000ff">'Datei leer.txt wurde wieder gel&ouml;scht!'</font></div><!-- code END-->Auch hier k&ouml;nnen wir (&uuml;brigens bei jeder Datei-spezifischen Anweisung) wieder &uuml;ber die Variable [errorcode] pr&uuml;fen, ob die jeweilige Dateioperation erfolgreich war ([errorcode] = '0') oder ob nicht ([errorcode] = '-1').<br /><br />Um eine Datei zu kopieren bietet RapidBATCH die COPYFILE-Anweisung. Sie kopiert den Inhalt im Verh&auml;ltnis 1:1 aus einer Quelldatei in eine Zieldatei. Die Anweisung RENAMEFILE erm&ouml;glicht das Umbenennen bzw. Verschieben einer Datei.<br /><br />Beispiel:<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem C:\jmksf\rb5\readme.txt in C:\test.txt kopieren...</font><br />copyfile <font color="#0000ff">'C:\jmksf\rb5\readme.txt'</font>, <font color="#0000ff">'C:\test.txt'</font><br /><br /><font color="#808080">rem C:\TEST.TXT &ouml;ffnen...</font><br />open <font color="#0000ff">'C:\test.txt'</font><br /><br /><font color="#808080">rem C:\TEST.TXT wieder l&ouml;schen...</font><br />delfile <font color="#0000ff">'C:\test.txt'</font><br /><br /><font color="#808080">rem C:\jmksf\rb5\readme.txt in C:\test.txt umbenennen...</font><br />renamefile <font color="#0000ff">'C:\jmksf\rb5\readme.txt'</font>, <font color="#0000ff">'C:\test.txt'</font><br /><font color="#808080">rem C:\TEST.TXT &ouml;ffnen...</font><br />open <font color="#0000ff">'C:\test.txt'</font><br /><br /><font color="#808080">rem C:\test.txt wieder zur&uuml;ck in C:\jmksf\rb5\readme.txt benennen...</font><br />renamefile <font color="#0000ff">'C:\test.txt'</font>, <font color="#0000ff">'C:\jmksf\rb5\readme.txt'</font></div><!-- code END-->COPYFILE und RENAMEFILE erlauben keine Wildcards, d.h. es kann immer nur eine einzelne Datei kopiert werden. Wie man aber trotzdem mehrere Dateien kopieren/verschieben kann, besprechen wir weiter unten.<br /><br /><br />Ob eine Datei bereits existiert oder nicht l&auml;sst sich mit der Funktion FILEEXISTS &uuml;berpr&uuml;fen.<br /><br /><!-- code BEGIN --><div class="code">fileexists <font color="#000080">[fx]</font> = <font color="#0000ff">'C:\AnyFile.txt'</font><br /><b>if</b> <font color="#000080">[fx]</font> = <font color="#0000ff">'-1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Datei existiert nicht.'</font><br /><b>else</b><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Datei existiert!'</font><br /><b>endif</b></div><!-- code END-->FILEEXISTS gibt also den Wert '-1' an die R&uuml;ckgabevariable zur&uuml;ck, wenn die Datei nicht existiert. Ansonsten ist der R&uuml;ckgabewert '0'.<br /><br />Zu den leistungsst&auml;rksten und effektivsten Funktionen, die RapidBATCH bereitstellt, geh&ouml;rt die FINDFILES-Funktion. FINDFILES listet alle Dateien eines Verzeichnisses, erm&ouml;glicht aber auch das Einlesen eines Verzeichnisses mitsamt aller Unterverzeichnisse.<br /><br />Folgendes Script erzeugt eine Liste aller Dateien des aktuellen Verzeichnisses und zeigt diese in einem LISTBOX-Dialog an.<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem Dateiliste erzeugen</font><br />findfiles <font color="#000080">[dateiliste]</font> = <font color="#0000ff">'*'</font>, <font color="#0000ff">'1'</font><br /><br /><font color="#808080">rem Anzeige der Dateiliste in einer LISTBOX</font><br />listbox <font color="#000080">[datei]</font> = <font color="#000080">[current]</font>, <font color="#000080">[dateiliste]</font><br /><b>if</b> <font color="#000080">[datei]</font> ! <font color="#0000ff">''</font> echo <font color="#0000ff">'Gew&auml;hlte Datei: '</font> # <font color="#000080">[datei]</font><br /><b>end</b></div><!-- code END--><div class="image"><img src="img/sysop_filelist.gif" alt="Auflistung von Dateien in einer LISTBOX" title="Auflistung der gefundenen Dateien" /><br />Die mit FINDFILES erzeugte Dateiliste wird in einer LISTBOX zur Anzeige und Auswahl gebracht.</div>FINDFILES erwartet als Parameter einen so genannten Pfad-/Dateifilter, d.h. es werden nur Dateien, die sich im angegebenen Verzeichnis befinden und dem gegebene Dateifilter entsprechen, gelistet. F&uuml;r den Dateifilter k&ouml;nnen so genannte Wildcards benutzt werden; Diese Wildcards (Platzhalter) werden durch die Zeichen * und ? repr&auml;sentiert und erm&ouml;glichen das Suchen nach bestimmten Mustern. Ein * ist ein Wildcard f&uuml;r ein beliebiges Textmuster, ? f&uuml;r ein einzelnes Zeichen.<br />Der zweite Parameter repr&auml;sentiert die Tiefe, bis zu wieviele Unterverzeichnisse eingelesen werden sollen; Der Wert 1 bedeutet, dass nur das aktuelle bzw. angegebene Verzeichnis durchsucht wird, 2 durchsucht das aktuelle bzw. angegebene Verzeichnis und alle darin enthaltenen Unterverzeichnisse. Haben diese Unterverzeichnisse wiederum Unterverzeichnisse, werden diese nicht mehr eingelesen; Wenn man diese auch einlesen will, muss man als Tiefe den Wert 3 angeben. Diese Tiefen-Angaben lieﬂen sich jetzt bis ins Unendliche fortf&uuml;hren. Wird als Tiefe der Wert 0 angegeben, so wird bis zu einer maximalen Verzeichnistiefe von 255 gesucht und gelistet.<br /><br />R&uuml;ckgabewert von FINDFILES ist eine Dateiliste, in der jeder Dateiname durch das in der vordeklarierten Variablen [std_sep] definierte Separationszeichen (im Normalfall das Pipe-Zeichen &quot;|&quot;) getrennt ist. Wir k&ouml;nnen diese Liste daher direkt an LISTBOX als Item-Liste &uuml;bergeben.<br /><br />Um einmal die Verwendung der verschiedenen Filter, Wildcards und Verzeichnistiefenangaben zu demonstrieren, hier ein paar kommentierte Beispielaufrufe von FINDFILES:<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem Alle Dateien im aktuellen Verzeichnis auflisten:</font><br />findfiles <font color="#000080">[dateiliste]</font> = <font color="#0000ff">'*'</font>, <font color="#0000ff">'1'</font><br /><font color="#808080">rem (Der Filter "*" sucht nach allen Dateien, die es im Verzeichnis gibt)</font><br /><br /><font color="#808080">rem Alle TXT-Dateien im aktuellen Verzeichnis und allen Unterverzeichnissen</font><br /><font color="#808080">rem bis zu einer Ebene auflisten:</font><br />findfiles <font color="#000080">[dateiliste]</font> = <font color="#0000ff">'*.txt'</font>, <font color="#0000ff">'2'</font><br /><font color="#808080">rem (Der Filter "*.txt" sucht nach allen Dateien, die die Dateiendung</font><br /><font color="#808080">rem .TXT haben. Es werden also z.B. Dateinamen wie "hallo.txt", "x.txt"</font><br /><font color="#808080">rem und "txt.txt" eingelesen (wenn diese denn existieren)).</font><br /><br /><font color="#808080">rem Alle Dateien im aktuellen Verzeichnis auflisten, die mit "hallo"</font><br /><font color="#808080">rem beginnen und mit ".DOC" enden:</font><br />findfiles <font color="#000080">[dateiliste]</font> = <font color="#0000ff">'hallo*.doc'</font>, <font color="#0000ff">'1'</font><br /><br /><font color="#808080">rem Alle Dateien im aktuellen Verzeichnis auflisten, die mit "h", einem beliebigen</font><br /><font color="#808080">rem Buchstaben und "llo" beginnen und mit irgend einer Dateiendung enden:</font><br />findfiles <font color="#000080">[dateiliste]</font> = <font color="#0000ff">'h?llo*.*'</font>, <font color="#0000ff">'1'</font><br /><font color="#808080">rem (Hier werden z.B. Dateinamen wie "hallo92.sav", "hello.bak", "hullokkn.exe"</font><br /><font color="#808080">rem und "hhlloHALLO." gefunden!)</font><br /><br /><font color="#808080">rem Alle Dateien im aktuellen Verzeichnis und allen Unterverzeichnissen</font><br /><font color="#808080">rem auflisten, die eine Dateiendung haben:</font><br />findfiles <font color="#000080">[dateiliste]</font> = <font color="#0000ff">'*.*'</font>, <font color="#0000ff">'0'</font><br /><br /><font color="#808080">rem Alle .RB-Dateien im aktuellen Verzeichnis auflisten, die nur einen</font><br /><font color="#808080">rem Buchstaben im Dateinamen haben:</font><br />findfiles <font color="#000080">[dateiliste]</font> = <font color="#0000ff">'?.rb'</font>, <font color="#0000ff">'1'</font><br /><font color="#808080">rem (Der Filter "?.rb" sucht nach allen Dateien, die einen einzelnen</font><br /><font color="#808080">rem Buchstaben vor dem Punkt haben (? = einzelner Buchstabe), es werden</font><br /><font color="#808080">rem also nur die Dateien "a.rb", "x.rb" oder "1.rb" gelistet (wenn</font><br /><font color="#808080">rem diese denn existieren))</font></div><!-- code END-->Zum Schluss noch ein Beispiel, wie Sie mit Hilfe der Funktionen FINDFILES und GETTOK eine Prozedur programmieren, die mehrere Dateien in ein Zielverzeichnis kopiert (mit Hilfe von COPYFILE, da diese Funktion ja von sich aus keine Wildcards unterst&uuml;tzt):<br /><br /><!-- code BEGIN --><div class="code"><b>proc</b> copyfiles: <font color="#000080">[quelle]</font>, <font color="#000080">[ziel]</font>, <font color="#000080">[filter]</font><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem Lokale Variablen vereinbaren</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>dec</b> <font color="#000080">[i]</font>, <font color="#000080">[datei]</font>, <font color="#000080">[dateiliste]</font><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem Dateiliste holen</font><br />&nbsp;&nbsp;&nbsp;&nbsp;findfiles <font color="#000080">[dateiliste]</font> = <font color="#000080">[quelle]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[filter]</font>, <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[dateiliste]</font> = <font color="#0000ff">''</font> <b>ret</b><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem Ziel-Verzeichnis zur Sicherheit erzeugen</font><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem (wird nat&uuml;rlich, wenn es schon existiert, nicht &uuml;berschrieben)</font><br />&nbsp;&nbsp;&nbsp;&nbsp;mkdir <font color="#000080">[ziel]</font><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem Dateiliste durchlaufen</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[i]</font> = <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>repeat</b><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[i]</font> + <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gettok <font color="#000080">[datei]</font> = <font color="#000080">[dateiliste]</font>, <font color="#0000ff">'|'</font>, <font color="#000080">[i]</font><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rem Wenn [datei] nicht leer ist, Datei von</font><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rem Quelle nach Ziel kopieren</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[datei]</font> ! <font color="#0000ff">''</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copyfile <font color="#000080">[quelle]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[datei]</font>, <font color="#000080">[ziel]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[datei]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>endif</b><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>until</b> <font color="#000080">[datei]</font> = <font color="#0000ff">''</font><br /><b>endproc</b><br /><br /><font color="#808080">rem Aufruf (kopiert alle Dateien mit dem Muster "*.*" aus dem</font><br /><font color="#808080">rem Verzeichnis "C:\jmksf\rb5" in das Verzeichnis "C:\test"):</font><br />copyfiles <font color="#0000ff">'C:\jmksf\rb5'</font>, <font color="#0000ff">'C:\test'</font>, <font color="#0000ff">'*.*'</font><br /><b>end</b></div><!-- code END--><br /><br />

		<div class="line">&nbsp;</div>

		<div id="copyright">
			Copyright &copy; 2000-2006 by J.M.K S.F. Software Technologies, Jan Max Meyer<br />
			All rights reserved.
		</div>
	</body>
</html>
