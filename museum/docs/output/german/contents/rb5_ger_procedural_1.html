<html>
	<head>
		<title>Benutzerdefinierte Prozeduren und Funktionen</title>
		<link rel="stylesheet" href="jmksf.css" type="text/css"></link>
	</head>

	<body>
		<div id="top">
			<img src="rb5.png" alt="RapidBATCH Logo" />
			Benutzerdefinierte Prozeduren und Funktionen
		</div>
		
		<div class="line">&nbsp;</div>
		
		Eines der effektivsten, neuen Features von RapidBATCH 5 ist die Einf&uuml;hrung von benutzerdefinierbaren Prozeduren und Funktionen, ein Feature, das f&uuml;r die moderne, strukturierte Programmierung einfach unerl&auml;sslich ist. Mit Prozeduren k&ouml;nnen Sie die Programmierung Ihrer Scripts erheblich beschleunigen, indem Sie neue Befehle und Funktionen, die genau f&uuml;r Ihre Anwendungen zugeschnitten sind, einfach selbst in RapidBATCH als kleine Unterprogramme implementieren. Eine Prozedur l&auml;sst sich also quasi als eine Zusammenfassung von mehreren RapidBATCH-Anweisungen und -Kontrollstrukturen zu einer komplett neuen Anweisung (oder Funktion), die dann in RapidBATCH verwendet werden kann, beschreiben.<br /><br />Prozeduren werden einmal in einem Script definiert und k&ouml;nnen anschlieﬂend wie ganz normale Anweisungen oder Funktionen gehandhabt werden. Es ist daher sinnvoll, Prozedurdefinitionen immer zu Anfang eines RapidBATCH-Scripts anzugeben. Werden die gleichen Prozeduren in mehreren, unterschiedlichen Scripts verwendet, so k&ouml;nnen diese in einer separaten Script-Datei als Library-Datei definiert und sp&auml;ter zur Verwendung im eigentlichen Script mittels der INCLUDE-Anweisung eingebunden werden (mehr zu diesem Verfahren jedoch sp&auml;ter!).<br /><br />Eine einfache Prozedur (ohne R&uuml;ckgabewert) wird mit dem Schl&uuml;sselwort PROC eingeleitet. Direkt nach PROC folgt der Name, &uuml;ber den die neue Prozedur aufgerufen werden soll. Dieser darf keine Leer- oder Sonderzeichen enthalten. Nach dem Prozedurnamen kann dann, gefolgt von einem Doppelpunkt, eine Liste an Parametervariablen (die pro Variable durch Kommata getrennt sein m&uuml;ssen) angegeben werden, wobei auch eine parameterlose Prozedur definiert werden kann (in solch einem Fall ist kein Doppelpunkt erforderlich!). Nach der PROC-Anweisung folgt dann der entsprechende Code, den die Prozedur enth&auml;lt. Ausgeleitet wird dieser Code mit der Anweisung ENDPROC. Hinter ENDPROC kann dann eine neue Prozedurdefinition oder normaler Script-Code folgen. Auch hier gilt: Zwischen den Anweisungen PROC und ENDPROC sollte der Script-Code zur besseren Lesbarkeit einger&uuml;ckt werden!<br /><br />Ein einfaches Beispiel stellt nun folgendes Script dar. Es definiert eine parameterlose Prozedur &quot;test&quot;, welche ein Meldungsfenster ausgeben soll.<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem Prozedur-Demoscript</font><br /><b>proc</b> test<br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Dies ist die Prozedur TEST!'</font><br /><b>endproc</b><br /><br />echo <font color="#0000ff">'Vor der Prozedur...'</font><br />test<br />echo <font color="#0000ff">'...nach der Prozedur'</font><br />echo <font color="#0000ff">'Und noch einmal!'</font><br />test<br /><b>end</b></div><!-- code END-->Wenn wir nun eine Prozedur mit Parametervariablen definieren wollen, m&uuml;ssen diese, wie bereits oben beschrieben, als Parameterliste beim Schl&uuml;sselwort PROC angegeben werden. Die dort definierten Variablennamen werden beim Aufruf der Prozedur deklariert und bei der Beendigung der Prozedur wieder aus dem Speicher entfernt. Dies nennt man &quot;lokale Variablendeklaration&quot;, da diese Variablen (und auch alle Variablen, die in der Prozedur erzeugt werden) nur zur Laufzeit der Prozedur verwendet werden k&ouml;nnen. Wir werden sp&auml;ter noch genauer auf den Unterschied zwischen lokalen und globalen Variablen eingehen.<br /><br />Ein einfaches Beispiel f&uuml;r eine Prozedur mit Parametern stellt folgendes Script dar. Es definiert die Prozedur &quot;summe&quot; zur Summierung zweier Werte, die als Parameter &uuml;bergeben werden. Das Ergebnis der Addition wird als Text in einem Meldungsfenster ausgegeben.<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem Prozedur-Demoscript mit Parametern</font><br /><b>proc</b> summe: <font color="#000080">[wert1]</font>, <font color="#000080">[wert2]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>dec</b> <font color="#000080">[ergebnis]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[ergebnis]</font> = <font color="#000080">[wert1]</font> + <font color="#000080">[wert2]</font><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Die Summe von '</font> # <font color="#000080">[wert1]</font> # <font color="#0000ff">' und '</font> # <font color="#000080">[wert2]</font> # <font color="#0000ff">' ist '</font> # <font color="#000080">[ergebnis]</font><br /><b>endproc</b><br /><br /><font color="#808080">rem Konstante Parameterwerte</font><br />summe <font color="#0000ff">'7'</font>, <font color="#0000ff">'13'</font><br /><br /><font color="#808080">rem Variable Parameterwerte</font><br />inputbox <font color="#000080">[a]</font> = <font color="#0000ff">'Wert A:'</font>, <font color="#0000ff">'Bitte geben Sie eine Zahl ein:'</font>, <font color="#0000ff">''</font><br /><b>if</b> <font color="#000080">[a]</font> = <font color="#0000ff">''</font> <b>halt</b><br />inputbox <font color="#000080">[b]</font> = <font color="#0000ff">'Wert B:'</font>, <font color="#0000ff">'Bitte geben Sie eine Zahl ein:'</font>, <font color="#0000ff">''</font><br /><b>if</b> <font color="#000080">[b]</font> = <font color="#0000ff">''</font> <b>halt</b><br /><br />summe <font color="#000080">[a]</font>, <font color="#000080">[b]</font><br /><b>end</b></div><!-- code END-->Aus dieser Prozedur l&auml;sst sich jetzt auch eine Funktion definieren, die als R&uuml;ckgabewert die Summe beider Parameter zur&uuml;ckgibt. Funktionen sind dabei nicht weniger schwer programmierbar wie einfache Prozeduren, nur dass wir hier anstatt der Schl&uuml;sselw&ouml;rter PROC und ENDPROC die Schl&uuml;sselw&ouml;rter FUNC und ENDFUNC verwenden. Um den Wert an die Ergebnisvariable, die beim Prozeduraufruf mit angegeben werden muss, zur&uuml;ckzugeben, verwenden wir hier ausserdem die Anweisung RET, was soviel bedeutet wie &quot;return&quot; (zu deutsch: &quot;Zur&uuml;ckkehren&quot;). RET kann auch, ohne R&uuml;ckgabewert als Parameter, in einfachen Prozeduren eingesetzt werden, um diese vorzeitig vor dem ENDPROC zu verlassen.<br /><br />Hier nun unser obiges Script mit einer Funktion &quot;summe&quot;.<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem Funktions-Demoscript</font><br /><b>func</b> summe: <font color="#000080">[wert1]</font>, <font color="#000080">[wert2]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>dec</b> <font color="#000080">[ergebnis]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[ergebnis]</font> = <font color="#000080">[wert1]</font> + <font color="#000080">[wert2]</font><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>ret</b> <font color="#000080">[ergebnis]</font><br /><b>endfunc</b><br /><br /><font color="#808080">rem Konstante Parameterwerte</font><br />summe <font color="#000080">[erg]</font> = <font color="#0000ff">'7'</font>, <font color="#0000ff">'13'</font><br />echo <font color="#0000ff">'Summe: '</font> # <font color="#000080">[erg]</font><br /><br /><font color="#808080">rem Variable Parameterwerte</font><br />inputbox <font color="#000080">[a]</font> = <font color="#0000ff">'Wert A:'</font>, <font color="#0000ff">'Bitte geben Sie eine Zahl ein:'</font>, <font color="#0000ff">''</font><br /><b>if</b> <font color="#000080">[a]</font> = <font color="#0000ff">''</font> <b>halt</b><br />inputbox <font color="#000080">[b]</font> = <font color="#0000ff">'Wert B:'</font>, <font color="#0000ff">'Bitte geben Sie eine Zahl ein:'</font>, <font color="#0000ff">''</font><br /><b>if</b> <font color="#000080">[b]</font> = <font color="#0000ff">''</font> <b>halt</b><br /><br />summe <font color="#000080">[erg]</font> = <font color="#000080">[a]</font>, <font color="#000080">[b]</font><br />echo <font color="#0000ff">'Summe: '</font> # <font color="#000080">[erg]</font><br /><b>end</b></div><!-- code END-->Und schon haben Sie Ihre erste, eigene Funktion in RapidBATCH programmiert! Nat&uuml;rlich ist dies nur ein einfaches Beispiel, denn normalerweise addiert mein zwei Werte direkt im String, also <br /><br /><!-- code BEGIN --><div class="code">echo <font color="#0000ff">'Summe: '</font> # <font color="#0000ff">'32'</font> + <font color="#0000ff">'5'</font><br /><b>end</b></div><!-- code END-->Als einfaches Modell f&uuml;r die Programmierung von Prozeduren und Funktionen war dieses Beispiel aber doch recht leicht verst&auml;ndlich. Interessant wird es erst, wenn wir rekursive Prozeduren schreiben oder mit Arrays arbeiten, was in den n&auml;chsten Kapiteln folgt.<br /><br />Eine Sache, die an dieser Stelle aber noch sehr wichtig ist, sind die bereits angesprochenen lokalen Variablen. Man unterscheidet bei der prozeduralen Programmierung immer zwischen globalen und lokalen Variablen. In RapidBATCH sind alle Variablen global, die ausserhalb von Prozeduren, irgendwo im Script-Code, deklariert werden. Auf globale Variablen k&ouml;nnen alle Prozeduren zur Laufzeit zugreifen, d.h. wenn wir eine globale Variable [test] haben, k&ouml;nnen wir auch in einer Prozedur auf sie zugreifen. Anders ist es bei Variablen, die als Parameter in Prozeduren und Funktionen definiert oder in den Prozeduren/Funktionen deklariert wurden, diese sind n&auml;mlich alle lokal. Man kann auch beim Aufruf einer weiteren Prozedur aus einer Prozedur nicht auf die lokalen Werte der aufrufenden Prozedur zugreifen. W&auml;re dies m&ouml;glich, w&uuml;rde ein immenses Chaos ausbrechen, was die Programmierung rekursiver Prozeduren (siehe n&auml;chstes Kapitel) sowie die strukturierte, prozedurale Programmierung im Allgemeinen v&ouml;llig unm&ouml;glich und zwecklos machen w&uuml;rde. Der Unterschied zwischen lokalen und globalen Variablen kann manchmal auch zu sehr viel Verwirrung f&uuml;hren, daher rate ich, um Probleme mit globalen Variablen zu vermeiden, immer jede lokale Variable, die nicht als Parameter &uuml;bergeben wird, in der Prozedur mit Hilfe der DEC-Anweisung explizit zu deklarieren. Einfachstes Fallbeispiel ist folgendes Script:<br /><br /><!-- code BEGIN --><div class="code"><font color="#000080">[i]</font> = <font color="#0000ff">'10'</font><br /><br /><b>proc</b> test<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[i]</font> = <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'i ist hier '</font> # <font color="#000080">[i]</font><br /><b>endproc</b><br /><br />echo <font color="#0000ff">'i ist hier '</font> # <font color="#000080">[i]</font><br />test<br />echo <font color="#0000ff">'i ist hier '</font> # <font color="#000080">[i]</font><br /><b>end</b></div><!-- code END-->Was hier passiert ist recht einfach: Wir wollen [i] in der Prozedur &quot;test&quot; lokal verwenden. Wir weisen [i] einfach einen Wert zu und nehmen an, dass [i] automatisch neu deklariert wird. Dies wird sie jedoch nicht, da [i] bereits schon global existiert, und RapidBATCH annimmt, wir wollten auf die globale Variable [i], die ja bereits existiert, zugreifen. Deshalb m&uuml;ssen wir die Variable [i] nun explizit noch einmal f&uuml;r diese Prozedur deklarieren, indem wir die DEC-Anweisung verwenden:<br /><br /><!-- code BEGIN --><div class="code"><font color="#000080">[i]</font> = <font color="#0000ff">'10'</font><br /><br /><b>proc</b> test<br />&nbsp;&nbsp;&nbsp;&nbsp;<b>dec</b> <font color="#000080">[i]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[i]</font> = <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'i ist hier '</font> # <font color="#000080">[i]</font><br /><b>endproc</b><br /><br />echo <font color="#0000ff">'i ist hier '</font> # <font color="#000080">[i]</font><br />test<br />echo <font color="#0000ff">'i ist hier '</font> # <font color="#000080">[i]</font><br /><b>end</b></div><!-- code END-->In diesem Falle wird [i] neu, als lokale Variable, in der Prozedur &quot;test&quot; deklariert. Nach Beendigung der Prozedur wird die lokale [i]-Variable aus dem Speicher entfernt, und es kann die &quot;alte&quot;, globale [i]-Variable weiter verwendet werden.<br /><br />M&ouml;glicherweise haben Sie noch ein wenig Probleme, den Sinn hinter den lokalen und globalen Variablen richtig zu durchschauen, aber je mehr Sie in RapidBATCH programmieren, desto klarer werden solche Strukturen und Zusammenh&auml;nge werden.<br /><br />Wie Sie professionell die prozedurale Programmierung in RapidBATCH ausnutzen k&ouml;nnen, wird in den folgenden Kapiteln genauer erl&auml;utert. Professionelle Anwendungsbeispiele finden Sie auch in den zahlreichen Beispielprogrammen und Bibliotheksfunktionen, die das RapidBATCH-Programmpaket beinhaltet.<br /><br />

		<div class="line">&nbsp;</div>

		<div id="copyright">
			Copyright &copy; 2000-2006 by J.M.K S.F. Software Technologies, Jan Max Meyer<br />
			All rights reserved.
		</div>
	</body>
</html>
