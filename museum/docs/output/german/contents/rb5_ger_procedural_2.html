<html>
	<head>
		<title>Rekursive Programmierung von Prozeduren</title>
		<link rel="stylesheet" href="jmksf.css" type="text/css"></link>
	</head>

	<body>
		<div id="top">
			<img src="rb5.png" alt="RapidBATCH Logo" />
			Rekursive Programmierung von Prozeduren
		</div>
		
		<div class="line">&nbsp;</div>
		
		Bei der rekursiven Programmierung ruft sich eine Prozedur oder Funktion in einem Script selbst wieder auf. Wichtig dabei ist, dass eine Abbruchbedingung gegeben ist, weil sich das rekursive Programm sonst (theoretisch) unendlich oft selbst aufrufen w&uuml;rde. Die rekursive Programmierung bietet daher eine elegante Art und Weise, wie man in sich verschachtelte Operationen schnell und einfach durchf&uuml;hren kann. Diese darf in RapidBATCH nat&uuml;rlich nicht fehlen!<br /><br />Ein einfaches Beispiel f&uuml;r ein rekursiv ablaufendes Programm ist die Berechnung der Fakult&auml;t. Die Berechnung der Fakult&auml;t ist mathematisch wie folgt definiert:<br /><ul/><li/>Die Fakult&auml;t der Zahl 0 ist definitionsgem&auml;ß 1.</li/><li/>Die Fakult&auml;t einer ganzen Zahl, die gr&ouml;ßer als 0 ist, ist das Produkt dieser Zahl mit der Fakult&auml;t der n&auml;chstkleineren ganzen Zahl.</li/></ul/><br />Wir werden nun solch ein Script programmieren, welches die Fakult&auml;t rekursiv berechnet:<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem Funktion fac zur Berechnung der Fakult&auml;t</font><br /><b>func</b> fac: <font color="#000080">[x]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>dec</b> <font color="#000080">[ergebnis]</font><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[x]</font> = <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[ergebnis]</font> = <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>else</b><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rem Rekursiver Aufruf von fac</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fac <font color="#000080">[ergebnis]</font> = <font color="#000080">[x]</font> - <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[ergebnis]</font> * <font color="#000080">[x]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>endif</b><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>ret</b> <font color="#000080">[ergebnis]</font><br /><b>endfunc</b><br /><br /><font color="#808080">rem Erstaufruf der Funktion fac</font><br />fac <font color="#000080">[fakult&auml;t]</font> = <font color="#0000ff">'4'</font><br /><br /><font color="#808080">rem Ausgabe des Ergebisses</font><br />echo <font color="#0000ff">'Die Fakult&auml;t von 4 ist '</font> # <font color="#000080">[fakult&auml;t]</font><br /><b>end</b></div><!-- code END-->Das ist schon alles! Wie man unschwer erkennen kann, ruft sich die Funktion FAC rekursiv aus sich selber heraus auf - allerdings mit dem dekrementierten (um 1 verminderten) Wert der Variablen [x]. Abbruchbedingung in diesem Fall ist die Pr&uuml;fung, ob [x] den Wert '0' enth&auml;lt. Ist dies der Fall, ruft sich die Funktion nicht mehr weiterhin selbst auf, und l&ouml;st die Rekursion auf.<br />Da ja bei der Rekursion gleich mehrere Hundert (oder gar Tausend) Aufrufe der selben Funktion m&ouml;glich sind, befinden sich nat&uuml;rlich alle Aufrufe in einem so genannten Stack (&quot;Stapelspeicher&quot;) im Hauptspeicher des Computers. Durch die Abbruchbedingung werden nun alle aufgerufenen Funktionen wieder sorgf&auml;ltig abgearbeitet und beendet.<br />W&uuml;rde man bei unserer Fakult&auml;ts-Berechnungsfunktion keine solche Abbruchbedingung definieren, w&uuml;rde es irgendwann zu einem Speicher&uuml;berlauf und damit zum Programm- oder gar Systemabsturz kommen, da sich die Funktion so lange aufruft, bis kein Speicher mehr verf&uuml;gbar ist.<br /><br />Um den Verlauf der Rekursion unseres Fakult&auml;ts-Scripts etwas Verst&auml;ndlicher zu machen, k&ouml;nnen wir auch noch ein paar ECHO-Meldungen zur Programmverfolgung einf&uuml;gen:<br /><br /><!-- code BEGIN --><div class="code"><font color="#000080">[rekebene]</font> = <font color="#0000ff">'0'</font><br /><br /><font color="#808080">rem Funktion fac zur Berechnung der Fakult&auml;t</font><br /><b>func</b> fac: <font color="#000080">[x]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>dec</b> <font color="#000080">[ergebnis]</font><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem Ausgabe der Rekursionstiefe</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Start in Rekursionsebene '</font> # <font color="#000080">[rekebene]</font> # <font color="#0000ff">', Parameterwert '</font> # <font color="#000080">[x]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[rekebene]</font> + <font color="#0000ff">'1'</font><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[x]</font> = <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[ergebnis]</font> = <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>else</b><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rem Rekursiver Aufruf von fac</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fac <font color="#000080">[ergebnis]</font> = <font color="#000080">[x]</font> - <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[ergebnis]</font> * <font color="#000080">[x]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>endif</b><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem Ausgabe der Rekursionstiefe</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[rekebene]</font> - <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Ende in Rekursionsebene '</font> # <font color="#000080">[rekebene]</font> # <font color="#0000ff">', Ergebnis: '</font> # <font color="#000080">[ergebnis]</font><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>ret</b> <font color="#000080">[ergebnis]</font><br /><b>endfunc</b><br /><br /><font color="#808080">rem Erstaufruf der Funktion fac</font><br />fac <font color="#000080">[fakult&auml;t]</font> = <font color="#0000ff">'4'</font><br /><br /><font color="#808080">rem Ausgabe des Ergebisses</font><br />echo <font color="#0000ff">'Die Fakult&auml;t von 4 ist '</font> # <font color="#000080">[fakult&auml;t]</font><br /><b>end</b></div><!-- code END-->Dieses Beispiel zeigt auch nochmal die Verwendung von lokalen und globalen Variablen: Bei jedem rekursiven Aufruf werden alle lokalen Variablen der Prozedur/Funktion neu deklariert und k&ouml;nnen auch mit neuen bzw. unterschiedlichen Werten gef&uuml;llt werden. Es k&ouml;nnen daher (als Beispiel) mehrere Tausend Variablen [x] im Speicher existieren, doch nur eine ist lokal f&uuml;r den aktuellen Aufruf der Prozedur g&uuml;ltig; Daher k&ouml;nnen auch nicht die Werte von darunterliegenden Rekursionen ge&auml;ndert werden, w&auml;re dies m&ouml;glich, w&auml;re rekursive Programmierung v&ouml;llig unn&uuml;tz.<br />Anders verh&auml;lt es sich bei den altbekannten, globalen Variablen: Diese behalten ihren Wert, so wie unsere Variable [rekebene]. Wir k&ouml;nnen [rekebene] daher bei jedem Aufruf um 1 inkrementieren (erh&ouml;hen) und vor jeder Beendigung der Funktion wieder um eins dekrementieren (verringern). Somit k&ouml;nnen wir im Meldungfenster immer genau sehen, in welcher Rekursions-Tiefe wir uns gerade befinden. Wie Sie bei der Ausf&uuml;hrung des Scripts sicherlich bemerkt haben, ruft sich die Funktion bei &Uuml;bergabe des Wertes '4' genau 5 mal wieder selber auf, also bis der &Uuml;bergabe-Wert 0 ist.<br /><br />Rekursive Programmierung l&auml;sst sich sehr vielf&auml;ltig einsetzen und kann &auml;usserst effektiv sein.<br />Um Beispielsweise ein Verzeichnis zu duplizieren wurde in die RapidBATCH-Systemfunktions-Bibliothek (SYSTEM.RB) die Prozedur &quot;copydir&quot; implementiert, die ein komplettes Verzeichnis mitsamt Unterverzeichnissen rekursiv kopieren kann.<br /><br /><!-- code BEGIN --><div class="code"><b>proc</b> copyDir: <font color="#000080">[source]</font>, <font color="#000080">[target]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>dec</b> <font color="#000080">[tok]</font>, <font color="#000080">[i]</font>, <font color="#000080">[files]</font><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;findfiles <font color="#000080">[files]</font> = <font color="#000080">[source]</font> # <font color="#0000ff">'\*'</font>, <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[files]</font> = <font color="#0000ff">''</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[errorcode]</font> = <font color="#0000ff">'-1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>ret</b><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>endif</b><br />&nbsp;&nbsp;&nbsp;&nbsp;mkdir <font color="#000080">[target]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>repeat</b><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calcvar <font color="#000080">[i]</font> = <font color="#000080">[i]</font> + <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gettok <font color="#000080">[tok]</font> = <font color="#000080">[files]</font>, <font color="#0000ff">'|'</font>, <font color="#000080">[i]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[tok]</font> ! <font color="#0000ff">''</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getfileatt <font color="#000080">[isDir]</font> = <font color="#000080">[source]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[tok]</font>, <font color="#0000ff">'DIRECTORY'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[isDir]</font> = <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copyDir <font color="#000080">[source]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[tok]</font>, <font color="#000080">[target]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[tok]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>else</b><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copyfile <font color="#000080">[source]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[tok]</font>, <font color="#000080">[target]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[tok]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>endif</b><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>endif</b><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>until</b> <font color="#000080">[tok]</font> = <font color="#0000ff">''</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[errorcode]</font> = <font color="#0000ff">'0'</font><br /><b>endproc</b></div><!-- code END--><br /><br />

		<div class="line">&nbsp;</div>

		<div id="copyright">
			Copyright &copy; 2000-2006 by J.M.K S.F. Software Technologies, Jan Max Meyer<br />
			All rights reserved.
		</div>
	</body>
</html>
