<html>
	<head>
		<title>RapidBATCH Language Reference :: EXT</title>
		<link rel="stylesheet" href="jmksf.css" type="text/css" />
	</head>
	<body>
		<div id="top">
			<img src="rb5.png" alt="RapidBATCH Logo" />
			EXT
		</div>
	
		<div class="line">&nbsp;</div>
	
		<table cellspacing="10" width="100%">
			<tr>
				<td class="ref_label">Syntax:</td>
				<td class="ref_syntax">EXT Return-Value = DLL-File, Function-Name [, Parameter<sup>1</sup> [ ..., Parameter<sup>n</sup>] ]</td>
			</tr>
			<tr>
				<td class="ref_label">Description:</td>
				<td>Calls an external function that follows the RapidBATCH DLL interface conventions from a DLL-file.<br /><br />Using EXT (external), it is possible to use special, user-defined functionalities within a RapidBATCH Script. These functions can be written in huger programming languages like C, C++, Pascal or Visual Basic.<br /><br />Via EXT called functions need to follow the EXT interface format, else they are not correctly callable. The format for a DLL function that meets the EXT inteface convention (here defined using the C programming language) is defined as follow:<pre>int __declspec( dllexport ) _cdecl<br />	functionName( char** output, char** input, int input_count )<br />{<br />	/*<br />	Here, the functional code follows...<br />	*/<br /><br />	return 0;<br />}</pre>The parameters that are passed to the external function are handled the following way:<ul><li><b>char** output</b><br />This is the return pointer for the value that is stored into the return-variable of the RapidBATCH Script, which is firstly passed to the EXT-function. The memory must be allocated dynamically using the Windows API function LocalAlloc() with LPTR as first parameter. If this pointer is set or left (char*)NULL, EXT will return an empty string into the return variable. The allocated memory is freed by RapidBATCH automatically.</li><li><b>char** input</b><br />This pointer is an array-of-char pointers, where each entry complies with one parameter value that is specified behind the DLL-function name at the EXT-function.</li><li><b>int input_count</b><br />Countains the number of entries in the array input[].</li></ul></td>
			</tr>
			<tr>
				<td class="ref_label">Examples:</td>
				<td class="ref_code"><br /><font color="#808080">rem Functions from the DLL (C-Code)</font><br /><font color="#808080">rem</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;#define BUFFSIZE 10000</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;#define TEXTSIZE   100</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;#define ERROR_BAD_INPUT 11</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;&nbsp;&nbsp;&nbsp;gsSeparator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= (char*)NULL;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;&nbsp;&nbsp;&nbsp;gsBuffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= (char*)NULL;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;BOOL CALLBACK EnumWindowsProc( HWND hwnd, LPARAM lParam )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;{</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;&nbsp;&nbsp;&nbsp;Title[TEXTSIZE];</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset( Title, '\0', TEXTSIZE );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText( hwnd, Title, TEXTSIZE-1 );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( *Title != '\0' )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( IsWindowVisible( hwnd ) )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( *gsBuffer != '\0' )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcat( gsBuffer, gsSeparator );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcat( gsBuffer, Title );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( strlen( gsBuffer ) + strlen( gsSeparator ) + TEXTSIZE < BUFFSIZE )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( TRUE );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( FALSE );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( TRUE );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;}</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;int __declspec(dllexport ) _cdecl rbxCreateWindowList( char** Output, char** Input, int InputCount )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;{</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( Output == NULL )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( -1 );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*Output = LocalAlloc( LPTR, BUFFSIZE );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( *Output == NULL )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( -1 );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( InputCount != 1 || Input == NULL || *Input == NULL || **Input == 0 || strlen( *Input ) > TEXTSIZE )</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( -2 );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gsBuffer = *Output;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gsSeparator = *Input;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnumWindows( EnumWindowsProc,( LPARAM )NULL );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return( 0 );</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br /><font color="#808080">rem &nbsp;&nbsp;&nbsp;&nbsp;}</font><br /><font color="#808080">rem</font><br /><font color="#808080">rem Calling the DLL function:</font><br /><br /><b>ext</b> <font color="#000080">[window_list]</font> = <font color="#0000ff">'Test.dll'</font>, <font color="#0000ff">'rbxCreateWindowList'</font>, <font color="#000080">[new_line]</font><br />echo <font color="#0000ff">'Titles of the currently opened windows: '</font> # <font color="#000080">[new_line]</font> # <font color="#000080">[new_line]</font> # <font color="#000080">[window_list]</font><br /><b>end</b></td>
			</tr>
			<tr>
				<td class="ref_label">Remarks:</td>
				<td>Each DLL must implement a function LibMain(). This function is automatically called when the DLL is linked to and unlinked from the script. Using this routine, the DLL can, for example, initialize global variables or free used memory when the DLL is unlinked. When the DLL is loaded, LibMain() MUST in any case return TRUE, else RapidBATCH will immediatelly unlink the DLL again and return an error, that the DLL could not be loaded. At unload, the return value of LibMain() is simply ignored.<br /><br />Note that the DLL (and LibMain) is called only at the first call of the EXT-function, then the desired function that should be called is searched. In all following EXT-calls, LibMain is not called again, only the desired function.</td>
			</tr>
		</table>
	
		<div class="line">&nbsp;</div>
	
		<div id="copyright">
			Copyright &copy; 2000-2006 by J.M.K S.F. Software Technologies, Jan Max Meyer<br />
			All rights reserved.
		</div>
	</body>
</html>
