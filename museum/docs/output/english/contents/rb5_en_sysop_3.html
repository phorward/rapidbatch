<html>
	<head>
		<title>Operating on the file system</title>
		<link rel="stylesheet" href="jmksf.css" type="text/css"></link>
	</head>

	<body>
		<div id="top">
			<img src="rb5.png" alt="RapidBATCH Logo" />
			Operating on the file system
		</div>
		
		<div class="line">&nbsp;</div>
		
		To manage with files, RapidBATCH provides the instructions NEWFILE, DELFILE, COPYFILE, RENAMEFILE as well as the functions FILEEXISTS and FINDFILES.<br /><br />NEWFILE has the only purpose to create a new, empty file in the file system, DELFILE deletes a file. The use of both instructions is equivalent.<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem create a file</font><br />newfile <font color="#0000ff">'empty.txt'</font><br /><b>if</b> <font color="#000080">[errorcode]</font> = <font color="#0000ff">'0'</font> echo <font color="#0000ff">'The file empty.txt has been created!'</font><br /><br /><font color="#808080">rem delete the file again</font><br />delfile <font color="#0000ff">'empty.txt'</font><br /><b>if</b> <font color="#000080">[errorcode]</font> = <font color="#0000ff">'0'</font> echo <font color="#0000ff">'The file empty.txt has been deleted again!'</font></div><!-- code END-->Same procedure here: We're able to verify the operation success by verifying [errorcode] to the value of '0', meaning &quot;successful&quot;.<br /><br />To copy a file, RapidBATCH provides the COPYFILE-instruction. It creates a 1:1 copy of any file. The RENAMEFILE-instruction, expecting the same parameters as COPYFILE, renames or even moves a file into another directory or drive.<br /><br />An example:<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem copy C:\jmksf\rb5\readme.txt to C:\test.txt...</font><br />copyfile <font color="#0000ff">'C:\jmksf\rb5\readme.txt'</font>, <font color="#0000ff">'C:\test.txt'</font><br /><br /><font color="#808080">rem open C:\TEST.TXT...</font><br />open <font color="#0000ff">'C:\test.txt'</font><br /><br /><font color="#808080">rem delete C:\TEST.TXT again...</font><br />delfile <font color="#0000ff">'C:\test.txt'</font><br /><br /><font color="#808080">rem rename C:\jmksf\rb5\readme.txt to C:\test.txt ...</font><br />renamefile <font color="#0000ff">'C:\jmksf\rb5\readme.txt'</font>, <font color="#0000ff">'C:\test.txt'</font><br /><font color="#808080">rem open C:\TEST.TXT again...</font><br />open <font color="#0000ff">'C:\test.txt'</font><br /><br /><font color="#808080">rem rename C:\test.txt back to C:\jmksf\rb5\readme.txt again...</font><br />renamefile <font color="#0000ff">'C:\test.txt'</font>, <font color="#0000ff">'C:\jmksf\rb5\readme.txt'</font></div><!-- code END--><div class="remark">Please note that COPYFILE, RENAMEFILE and DELFILE do not allow wildcards to copy/move/delete a huger amount of files. To do this, use FINDFILES to build a file list and then operate on every single file within a loop. This method is discussed below.</div>To check if a file is already existing or not, the FILEEXISTS-function can be used. It returns the value '0' to the return variable in case if the specified file does exist, or else the value '-1'.<br /><br /><!-- code BEGIN --><div class="code">fileexists <font color="#000080">[fx]</font> = <font color="#0000ff">'C:\AnyFile.txt'</font><br /><b>if</b> <font color="#000080">[fx]</font> = <font color="#0000ff">'-1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'File is not existing.'</font><br /><b>else</b><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'The file exists!'</font><br /><b>endif</b></div><!-- code END-->One of the most powerful and effective functions RapidBATCH provides is the FINDFILES-function. FINDFILES has the only purpose to build and return a list of files by searching a whole directory (including its sub-directories until a desired depth) by using the wildcard-characters * and ?. In the result string the function returns, each file name is seperated by the RapidBATCH default seperation character (that is globally defined in the [std_sep]-variable and by default the pipe-character, &quot;|&quot;). Such lists are already known from the RapidBATCH build-in dialogs LISTBOX and TRAYMENU, and can be processed using the GETTOK-tokenizer function.<br /><br />The following script generates such a file list and displays the files it found in a LISTBOX-dialog, so they can be viewed.<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem generate file list of the current directory, listing ALL files (wildcard * only!)</font><br />findfiles <font color="#000080">[filelist]</font> = <font color="#0000ff">'*'</font>, <font color="#0000ff">'1'</font><br /><br /><font color="#808080">rem view the files in a LISTBOX-dialog</font><br />listbox <font color="#000080">[file]</font> = <font color="#000080">[current]</font>, <font color="#000080">[filelist]</font><br /><b>if</b> <font color="#000080">[file]</font> ! <font color="#0000ff">''</font> echo <font color="#0000ff">'You selected the file: '</font> # <font color="#000080">[file]</font><br /><b>end</b></div><!-- code END--><div class="image"><img src="img/sysop_filelist.gif" alt="LISTBOX listing all files of the current directory." title="Displaying the list generated by FINDFILES in a LISTBOX." /><br />Displaying the list of files generated by FINDFILES within the LISTBOX-dialog.</div>FINDFILES expects as the first parameter a so called path- and file-filter, that means only files that fit to this filter are appended to the returned file list. For the file filter, FINDFILES supports wildcards. Wildcards are the characters * and ?, where * represents any string of characters and ? any single character. For example, when specifying the filter '*.txt', all files with an ending '.txt' are listed. The corresponding string in front of the '.txt' can be any string, so that &quot;hello.txt&quot; is listed same as &quot;thisisanyname.txt&quot;.<br />The second, numerical parameter is the directory depth FINDFILES should list. You can list the files that are only in one directory by specifying the depth-value '1', all files in one directory and all its sub-directories by specifying the depth '2' or even all of a folder's sub-directories up to a maximum depth of 255 (which is nearly impossible!) by specifying the value '0'.<br /><br />Return value of FINDFILES is, as already mentioned, a list of relative file names where each file is seperated by the separation character defined in the [std_sep]-variable. Because of that, we can directly pass this list to LISTBOX where the files are displayed without any string modification.<br /><br />To demonstrate the usage of different file filters, wildcards and directory depths, take a look at the following calls of FINDFILES.<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem list all files in the current folder, including name of sub-folders:</font><br />findfiles <font color="#000080">[file_list]</font> = <font color="#0000ff">'*'</font>, <font color="#0000ff">'1'</font><br /><font color="#808080">rem (the "*" filter lists every file (or even sub-folder) that exists within the folder)</font><br /><br /><font color="#808080">rem list all txt-files within the current directory and one sub-directory level:</font><br />findfiles <font color="#000080">[file_list]</font> = <font color="#0000ff">'*.txt'</font>, <font color="#0000ff">'2'</font><br /><font color="#808080">rem (the filter "*.txt" finds all files having the .TXT extension. That means that</font><br /><font color="#808080">rem "hello.txt", "x.txt" as well as "txt.txt" is listed (if they would really exist!))</font><br /><br /><font color="#808080">rem list all files beginning with "hello" and having the ".DOC"-extension:</font><br />findfiles <font color="#000080">[file_list]</font> = <font color="#0000ff">'hello*.doc'</font>, <font color="#0000ff">'1'</font><br /><br /><font color="#808080">rem list all files beginning with an "h", followed by any character, and a following</font><br /><font color="#808080">rem "llo". Behind the "llo", any other name is allows. The files have an extension that</font><br /><font color="#808080">rem is seperated by a dot:</font><br />findfiles <font color="#000080">[file_list]</font> = <font color="#0000ff">'h?llo*.*'</font>, <font color="#0000ff">'1'</font><br /><font color="#808080">rem (in this case, the files "hallo92.sav", "hello.bak", "hullokkn.exe"</font><br /><font color="#808080">rem and "hhlloHELLO_funnyFileName." would be listed, if they would exist!)</font><br /><br /><font color="#808080">rem list all files having an extension in the whole directory, including all</font><br /><font color="#808080">rem sub-folders that exist (up to 255 sub-folder levels):</font><br />findfiles <font color="#000080">[file_list]</font> = <font color="#0000ff">'*.*'</font>, <font color="#0000ff">'0'</font><br /><br /><font color="#808080">rem list all .RB-files that only have one character in their name:</font><br />findfiles <font color="#000080">[file_list]</font> = <font color="#0000ff">'?.rb'</font>, <font color="#0000ff">'1'</font><br /><font color="#808080">rem (the filter "?.rb" lists all files that begin with one single character in the</font><br /><font color="#808080">rem front (the ?-wildcard means any single character), that means only files like</font><br /><font color="#808080">rem "a.rb", "x.rb" or "1.rb" are listed, but not "ab.rb" or something like that)</font></div><!-- code END-->And finally at the end of this chapter, a procedure called &quot;copyfiles&quot;, copying files from a source-directory into a target-directory. This procedure is also a demonstration how to copy (or even move) files using wildcards.<br /><br /><!-- code BEGIN --><div class="code"><b>proc</b> copyfiles: <font color="#000080">[source]</font>, <font color="#000080">[target]</font>, <font color="#000080">[filter]</font><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem declare locale variables</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>dec</b> <font color="#000080">[i]</font>, <font color="#000080">[file]</font>, <font color="#000080">[file_list]</font><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem reading the file list</font><br />&nbsp;&nbsp;&nbsp;&nbsp;findfiles <font color="#000080">[file_list]</font> = <font color="#000080">[source]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[filter]</font>, <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[file_list]</font> = <font color="#0000ff">''</font> <b>ret</b><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem creating the target-directory for secureness</font><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem (of course it won't be overwritten if it exists!)</font><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;mkdir <font color="#000080">[target]</font><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem go through the file list and copy each file</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[i]</font> = <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>repeat</b><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[i]</font> + <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gettok <font color="#000080">[file]</font> = <font color="#000080">[file_list]</font>, <font color="#0000ff">'|'</font>, <font color="#000080">[i]</font><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rem if [file] is not empty, copy it!</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[file]</font> ! <font color="#0000ff">''</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copyfile <font color="#000080">[source]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[file]</font>, <font color="#000080">[target]</font> # <font color="#0000ff">'\'</font> # <font color="#000080">[file]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>endif</b><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>until</b> <font color="#000080">[file]</font> = <font color="#0000ff">''</font><br /><b>endproc</b><br /><br /><font color="#808080">rem An example call of the procedure, copying all files from</font><br /><font color="#808080">rem "C:\jmksf\rb5" into "C:\test":</font><br />copyfiles <font color="#0000ff">'C:\jmksf\rb5'</font>, <font color="#0000ff">'C:\test'</font>, <font color="#0000ff">'*.*'</font><br /><b>end</b></div><!-- code END--><br /><br />

		<div class="line">&nbsp;</div>

		<div id="copyright">
			Copyright &copy; 2000-2006 by J.M.K S.F. Software Technologies, Jan Max Meyer<br />
			All rights reserved.
		</div>
	</body>
</html>
