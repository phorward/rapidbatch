<html>
	<head>
		<title>Working on the registry</title>
		<link rel="stylesheet" href="jmksf.css" type="text/css"></link>
	</head>

	<body>
		<div id="top">
			<img src="rb5.png" alt="RapidBATCH Logo" />
			Working on the registry
		</div>
		
		<div class="line">&nbsp;</div>
		
		Since version 5.0, RapidBATCH is also supporting directly access to the Windows-Registry. The &quot;registry&quot; is a a configuration and customization database provided by the Windows operating system family since Windows 95 and NT4. The major purpose of the Windows registry is to customize Windows, change system settings and to provide a possibility for programs and applications on the computer where they can save user- and system-dependend configuration informations and settings. Even the RapidBATCH Builder uses the registry to store e.g. the file history of the latest files or the tools provided in the Tools-menu in the menu bar.<br />The registry is edited using the program &quot;regedit&quot; which also is an inherent part of the Windows operating system. Run it by clicking <i>Start -&gt; Run</i> and then type &quot;regedit&quot; and hit enter.<br /><br />The registry is build on a Windows file system likely structure. There is a root, having five so called &quot;pre-defined keys&quot;. These keys cannot be changed or modified. Registry keys are like folders in the Windows file system, and may contain subkeys or even values. Values can be seen as files when we compare the registry with the Windows file system.<br /><br />Now, a short description of the five pre-defined keys in the registry's root.<ul>	<li><b>HKEY_CLASSES_ROOT</b><br />	This is a subkey of HKEY_LOCAL_MACHINE\Software. The information stored here ensures that the correct program opens when you open a file by using Windows Explorer.	</li>	<li><b>HKEY_CURRENT_USER</b><br />	Contains the root of the configuration information for the user who is currently logged on. The user's folders, screen colors, and Control Panel settings are stored here. This information is referred as a user's profile.</li>	<li><b>HKEY_LOCAL_MACHINE</b><br />	This key contains configuration information is important for any user.	</li>	<li><b>HKEY_USERS</b><br />	Contains the root of all user profiles on the computer. HKEY_CURRENT_USER is a subkey of HKEY_USERS.	</li>	<li><b>HKEY_CURRENT_CONFIG</b><br />	Contains information about the hardware profile used by the local computer at system startup.	</li></ul>Using RapidBATCH, you can use the registry now without compromise. You can evenly use it to automate the change of settings and values of any other application or even for your script itself, storing e.g. user-dependend informations. You can create and delete keys, create and modify values and even delete them.<br /><br />To create and delete a key, RapidBATCH provides the instruction NEWREGKEY and DELREGKEY. NEWREGKEY creates a new subkey, DELREGKEY deletes a subkey including all of its subkeys and values from the registry.<br />As parameter, both instructions expect a pre-defined main key identifier by specifing the values 'CLASSES_ROOT', 'CURRENT_CONFIG', 'CURRENT_USER', 'LOCAL_MACHINE' or 'USERS' for the particular key, as well as the path to the key that should be created newly. The following script generates a new key in HKEY_CURRENT_USER, that is named &quot;Test&quot;.<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem create a new registry key </font><br />newregkey <font color="#0000ff">'CURRENT_USER'</font>, <font color="#0000ff">'Test'</font><br /><b>if</b> <font color="#000080">[errorcode]</font> = <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Creating HKEY_CURRENT_USER\Test succeeded.'</font><br /><b>else</b><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Error when trying to create HKEY_CURRENT_USER\Test.'</font><br /><b>endif</b><br /><br /><font color="#808080">rem remove an existing key</font><br />delregkey <font color="#0000ff">'CURRENT_USER'</font>, <font color="#0000ff">'Test'</font><br /><b>if</b> <font color="#000080">[errorcode]</font> = <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'HKEY_CURRENT_USER\Test has been deleted successfully.'</font><br /><b>else</b><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Error when trying to delete HKEY_CURRENT_USER\Test.'</font><br /><b>endif</b></div><!-- code END-->It is important that the next higher key level of the key that should be created is existing, because NEWREGKEY does not create all keys automatically to reach its path if they do not exist, as it is the case at the MKDIR-instruction. There is no equivalency.<br /><br />If you now want to save into or add a value to a key, RapidBATCH provides the instruction LETREGKEY. LETREGKEY supports three different data types that can be written, these are STRING, BINARY and DWORD. Additionally, the instruction expects the pre-defined main key identifier as it is specified at NEWREGKEY/DELREGKEY as well as the path of the key. Next to this, a labeling text for the new value is optionally required (if this is left blank, the value is saved into the key itself, which is also possbile). The last parameter is finally the value in the particular format. The next example creates a new value named &quot;HelloWorld&quot; under the key &quot;Test&quot; in &quot;HKEY_CURRENT_USER&quot; (the key is created again using NEWREGKEY before the value is added).<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem create testing key</font><br />newregkey <font color="#0000ff">'CURRENT_USER'</font>, <font color="#0000ff">'Test'</font><br /><b>if</b> <font color="#000080">[errorcode]</font> = <font color="#0000ff">'0'</font><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem write a value to the registry</font><br />&nbsp;&nbsp;&nbsp;&nbsp;letregval <font color="#0000ff">'string'</font>, <font color="#0000ff">'CURRENT_USER'</font>, <font color="#0000ff">'Test'</font>, <font color="#0000ff">'HelloWorld'</font>, <font color="#0000ff">'This is a value!'</font><br /><br /><font color="#808080">&nbsp;&nbsp;&nbsp;&nbsp;rem has the value been saved successfully?</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[errorcode]</font> = <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'The value has been successfully written to the registry!'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>else</b><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Error when trying to write the registry.'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>endif</b><br /><b>endif</b></div><!-- code END--><div class="image"><img src="img/sysop_regvalue1.gif" alt="The just created value in the registry editor" title="Viewing the just created value in the registry editor." /><br />The value has been written successfully!</div>To write a binary value using LETREGVAL, the value has to be specified the same way as it is done at the PUTFILE-instruction: A list of ASCII character codes, separated by pipe-characters (or the as [std_sep] defined character). This example writes the string &quot;Hello World&quot; in binary form into the registry as the value name &quot;binary_HelloWorld&quot;:<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem write a binary value into the registry</font><br /><font color="#000080">[hello]</font> = <font color="#0000ff">'72|101|108|108|111|32|87|111|114|108|100'</font><br />letregval <font color="#0000ff">'binary'</font>, <font color="#0000ff">'CURRENT_USER'</font>, <font color="#0000ff">'Test'</font>, <font color="#0000ff">'binary_HelloWorld'</font>, <font color="#000080">[hello]</font><br /><br /><font color="#808080">rem was the operation successfull?</font><br /><b>if</b> <font color="#000080">[errorcode]</font> = <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'The registry has been written successfully.'</font><br /><b>else</b><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Error when trying to write the registry.'</font><br /><b>endif</b></div><!-- code END--><div class="image"><img src="img/sysop_regvalue2.gif" alt="View of a binary saved value in the registry editor." title="Editing the binary value in the registry editor." /><br />An evidence &quot;Hello World&quot; has been written in binary order to the registry!</div>If you want to save a DWORD-value, you may only save numerical 32-bit integer values into the registry.<br /><br />Reading from the registry is here equivalently done by using a function call GETREGVAL. Parameters are nearly the same like at LETREGVAL, except there is no value-parameter expected because this is returned by the function.<br /><br />This example reads the two values we wrote above from the registry again:<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem reading a string value</font><br />getregval <font color="#000080">[text]</font> = <font color="#0000ff">'string'</font>, <font color="#0000ff">'CURRENT_USER'</font>, <font color="#0000ff">'Test'</font>, <font color="#0000ff">'HelloWorld'</font><br />echo <font color="#0000ff">'String value in "HelloWorld" is: '</font> # <font color="#000080">[text]</font><br /><br /><font color="#808080">rem reading a binary value</font><br />getregval <font color="#000080">[data]</font> = <font color="#0000ff">'binary'</font>, <font color="#0000ff">'CURRENT_USER'</font>, <font color="#0000ff">'Test'</font>, <font color="#0000ff">'binary_HelloWorld'</font><br />echo <font color="#0000ff">'Read ASCII-list from "binary_HelloWorld": '</font> # <font color="#000080">[data]</font><br /><br /><font color="#808080">rem convert ASCII-codes to ASCII-characters and build a string of these characters</font><br /><font color="#000080">[i]</font> = <font color="#0000ff">'0'</font><br /><b>repeat</b><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[i]</font> + <font color="#0000ff">'1'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;gettok <font color="#000080">[char]</font> = <font color="#000080">[data]</font>, <font color="#000080">[std_sep]</font>, <font color="#000080">[i]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> <font color="#000080">[char]</font> ! <font color="#0000ff">''</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getchr <font color="#000080">[char]</font> = <font color="#000080">[char]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080">[plain]</font> # <font color="#000080">[char]</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<b>endif</b><br /><b>until</b> <font color="#000080">[char]</font> = <font color="#0000ff">''</font><br /><br /><font color="#808080">rem output the plain text</font><br />echo <font color="#0000ff">'Plain text converted from "binary_HelloWorld": '</font> # <font color="#000080">[plain]</font></div><!-- code END-->At the end, we delete the registry values again using the DELREGKEY instruction that is used to delete any value from the registry.<br /><br /><!-- code BEGIN --><div class="code"><font color="#808080">rem remove "HelloWorld"</font><br />delregval <font color="#0000ff">'CURRENT_USER'</font>, <font color="#0000ff">'Test'</font>, <font color="#0000ff">'HelloWorld'</font><br /><b>if</b> <font color="#000080">[errorcode]</font> ! <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Error when trying to delete "HelloWorld"'</font><br /><b>endif</b><br /><br /><font color="#808080">rem delete "binary_HelloWorld"</font><br />delregval <font color="#0000ff">'CURRENT_USER'</font>, <font color="#0000ff">'Test'</font>, <font color="#0000ff">'binary_HelloWorld'</font><br /><b>if</b> <font color="#000080">[errorcode]</font> ! <font color="#0000ff">'0'</font><br />&nbsp;&nbsp;&nbsp;&nbsp;echo <font color="#0000ff">'Error when trying to delete "binary_HelloWorld"'</font><br /><b>endif</b></div><!-- code END--><br /><br />

		<div class="line">&nbsp;</div>

		<div id="copyright">
			Copyright &copy; 2000-2006 by J.M.K S.F. Software Technologies, Jan Max Meyer<br />
			All rights reserved.
		</div>
	</body>
</html>
